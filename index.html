<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>スコアシート</title>
    <style>
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th, td {
        text-align: center;
        border: 1px solid black;
        padding: 8px;
      }
      th {
        background-color: #f2f2f2;
      }
      .edit-input {
        width: 100%;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <h1>スコアシート</h1>
    <table id="score-table">
      <thead>
        <tr>
          <th>#</th>
          <th>名前</th>
          <th>スコア</th>
          <th>備考</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>プレイヤー1</td>
          <td>0</td>
          <td></td>
          <td>
            <button onclick="addRow(this.parentNode.parentNode)">追加</button>
            <button onclick="deleteRow(this.parentNode.parentNode)">削除</button>
          </td>
        </tr>
        <tr>
  <td></td>
  <td></td>
  <td id="total-score"></td>
  <td></td>
  <td></td>
</tr>

            <button onclick="addRow(this.parentNode.parentNode)">追加</button>
            <button onclick="deleteRow(this.parentNode.parentNode)">削除</button>
          </td>
        </tr>
      </tbody>
    </table>

    <script>
      function addRow(row) {
        const newRow = row.cloneNode(true);
        newRow.querySelector('td:first-child').textContent = row.parentNode.rows.length;
        newRow.querySelector('td:nth-child(2)').textContent = '';
        newRow.querySelector('td:nth-child(3)').textContent = '0';
        newRow.querySelector('td:nth-child(4)').textContent = '';
        newRow.querySelector('button:nth-child(1)').onclick = function() { addRow(newRow) };
        newRow.querySelector('button:nth-child(2)').onclick = function() { deleteRow(newRow) };
        row.parentNode.insertBefore(newRow, row.nextSibling);
      }

      function deleteRow(row) {
        if (row.parentNode.rows.length > 2) {
          row.parentNode.removeChild(row);
          for (let i = 1; i < row.parentNode.rows.length; i++) {
            row.parentNode.rows[i].querySelector('td:first-child').textContent = i;
          }
        }
      }

      function editCell(cell) {
        const input = document.createElement('input');
        input.className = 'edit-input';
        input.value = cell.textContent;
        input.onblur = function() {
          cell.textContent = this.value;
        };
        cell.innerHTML = '';
        cell.appendChild(input);
        input.focus();
      }

      const cells = document.querySelectorAll('td:not(:last-child)');
      for (let i = 0; i < cells.length; i++) {
        cells[i].onclick = function() {
          editCell(this);
        };
      }
      
      function calculateTotalScore() {
  let total = 0;
  const scoreCells = document.querySelectorAll('td:nth-child(3)');
  for (let i = 0; i < scoreCells.length; i++) {
    const score = parseInt(scoreCells[i].textContent);
    if (!isNaN(score)) {
      total += score;
    }
  }
  document.getElementById('total-score').textContent = total;
}

// スコアが変更されたときに合計点数を計算する
const scoreInputs = document.querySelectorAll('td:nth-child(3)');
for (let i = 0; i < scoreInputs.length; i++) {
  scoreInputs[i].addEventListener('input', calculateTotalScore);
}

    </script>
  </body>
</html>
